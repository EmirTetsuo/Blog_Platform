{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\neo\\\\Desktop\\\\veb\\\\23.02.23\\\\Blog\\\\frontend\\\\src\\\\features\\\\PostItemContent.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { FaVolumeUp, FaVolumeMute, FaPlay, FaPause } from 'react-icons/fa';\nimport { useSelector } from 'react-redux';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const PostItemContent = _ref => {\n  _s();\n\n  let {\n    post\n  } = _ref;\n  const user = useSelector(state => state.auth.user);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isMuted, setIsMuted] = useState(false);\n  const [userWantsToPlay, setUserWantsToPlay] = useState(false);\n  const API_URL = process.env.REACT_APP_API_URL;\n  const videoRef = useRef(null);\n  useEffect(() => {\n    const videoElement = videoRef.current;\n    if (!videoElement) return;\n\n    const handleVisibilityChange = entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          if (userWantsToPlay) {\n            videoElement.play();\n            setIsPlaying(true);\n          }\n        } else {\n          videoElement.pause();\n          setIsPlaying(false);\n        }\n      });\n    };\n\n    const observer = new IntersectionObserver(handleVisibilityChange, {\n      threshold: 0.5\n    });\n    observer.observe(videoElement); // 🟡 ПРОВЕРКА: видно ли сейчас (в первый момент)\n\n    const rect = videoElement.getBoundingClientRect();\n    const isVisibleNow = rect.top >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight);\n\n    if (isVisibleNow && userWantsToPlay) {\n      videoElement.play();\n      setIsPlaying(true);\n    }\n\n    return () => {\n      observer.unobserve(videoElement);\n    };\n  }, [userWantsToPlay]);\n\n  const toggleMute = () => {\n    setIsMuted(prev => !prev);\n\n    if (videoRef.current) {\n      videoRef.current.muted = !isMuted;\n    }\n  };\n\n  const isVideo = url => {\n    const videoExtensions = ['.mp4', '.webm', '.ogg'];\n    return videoExtensions.some(ext => url.endsWith(ext));\n  };\n\n  useEffect(() => {\n    const videoElement = videoRef.current;\n    if (!videoElement) return;\n    const observer = new IntersectionObserver(entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          if (userWantsToPlay) {\n            videoElement.play();\n            setIsPlaying(true);\n          }\n        } else {\n          videoElement.pause();\n          setIsPlaying(false);\n        }\n      });\n    }, {\n      threshold: 0.5\n    } // хотя бы 50% видно\n    );\n    observer.observe(videoElement);\n    return () => {\n      observer.unobserve(videoElement);\n    };\n  }, [userWantsToPlay]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `${post.imgUrl && isVideo(post.imgUrl)} transition-all`,\n    children: post.imgUrl && isVideo(post.imgUrl) ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative group\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        width: \"100%\",\n        height: \"100%\",\n        maxheight: \"550px\",\n        muted: isMuted,\n        className: \"object-cover w-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"source\", {\n          src: `${API_URL}/${post.imgUrl}`,\n          type: \"video/mp4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 25\n        }, this), \"\\u0412\\u0430\\u0448 \\u0431\\u0440\\u0430\\u0443\\u0437\\u0435\\u0440 \\u043D\\u0435 \\u043F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0438\\u0432\\u0430\\u0435\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 flex justify-center items-center bg-black bg-opacity-30 group-hover:flex hidden\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: togglePlayPause,\n          className: \"text-white opacity-50 hover:opacity-75 transition\",\n          children: isPlaying ? /*#__PURE__*/_jsxDEV(FaPause, {\n            className: \"max-md:w-8 max-md:h-8 w-20 h-20\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 33\n          }, this) : /*#__PURE__*/_jsxDEV(FaPlay, {\n            className: \"max-md:w-8 max-md:h-8 w-20 h-20\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMute,\n        className: \"absolute bottom-4 right-4 p-2 bg-black bg-opacity-50 rounded-full text-white\",\n        children: isMuted ? /*#__PURE__*/_jsxDEV(FaVolumeMute, {\n          className: \"w-6 h-6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 29\n        }, this) : /*#__PURE__*/_jsxDEV(FaVolumeUp, {\n          className: \"w-6 h-6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 17\n    }, this) : /*#__PURE__*/_jsxDEV(\"img\", {\n      src: `${API_URL}/${post.imgUrl}`,\n      alt: \"Post content\",\n      className: \"object-cover w-full h-full max-md:max-h-[250px] max-h-[500px]\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 9\n  }, this);\n};\n\n_s(PostItemContent, \"si2jpV9WvW/9AiYhtJ2uLQ8xzyA=\", false, function () {\n  return [useSelector];\n});\n\n_c = PostItemContent;\n\nvar _c;\n\n$RefreshReg$(_c, \"PostItemContent\");","map":{"version":3,"names":["React","useState","useRef","useEffect","FaVolumeUp","FaVolumeMute","FaPlay","FaPause","useSelector","PostItemContent","post","user","state","auth","isPlaying","setIsPlaying","isMuted","setIsMuted","userWantsToPlay","setUserWantsToPlay","API_URL","process","env","REACT_APP_API_URL","videoRef","videoElement","current","handleVisibilityChange","entries","forEach","entry","isIntersecting","play","pause","observer","IntersectionObserver","threshold","observe","rect","getBoundingClientRect","isVisibleNow","top","bottom","window","innerHeight","document","documentElement","clientHeight","unobserve","toggleMute","prev","muted","isVideo","url","videoExtensions","some","ext","endsWith","imgUrl","togglePlayPause"],"sources":["C:/Users/neo/Desktop/veb/23.02.23/Blog/frontend/src/features/PostItemContent.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { FaVolumeUp, FaVolumeMute, FaPlay, FaPause } from 'react-icons/fa';\r\nimport { useSelector } from 'react-redux';\r\n\r\nexport const PostItemContent = ({ post }) => {\r\n    const user = useSelector((state) => state.auth.user);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const [userWantsToPlay, setUserWantsToPlay] = useState(false);\r\n    const API_URL = process.env.REACT_APP_API_URL;\r\n\r\n    const videoRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const videoElement = videoRef.current;\r\n        if (!videoElement) return;\r\n    \r\n        const handleVisibilityChange = (entries) => {\r\n            entries.forEach((entry) => {\r\n                if (entry.isIntersecting) {\r\n                    if (userWantsToPlay) {\r\n                        videoElement.play();\r\n                        setIsPlaying(true);\r\n                    }\r\n                } else {\r\n                    videoElement.pause();\r\n                    setIsPlaying(false);\r\n                }\r\n            });\r\n        };\r\n    \r\n        const observer = new IntersectionObserver(handleVisibilityChange, {\r\n            threshold: 0.5,\r\n        });\r\n    \r\n        observer.observe(videoElement);\r\n    \r\n        // 🟡 ПРОВЕРКА: видно ли сейчас (в первый момент)\r\n        const rect = videoElement.getBoundingClientRect();\r\n        const isVisibleNow =\r\n            rect.top >= 0 &&\r\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight);\r\n        \r\n        if (isVisibleNow && userWantsToPlay) {\r\n            videoElement.play();\r\n            setIsPlaying(true);\r\n        }\r\n    \r\n        return () => {\r\n            observer.unobserve(videoElement);\r\n        };\r\n    }, [userWantsToPlay]);\r\n    \r\n\r\n    const toggleMute = () => {\r\n        setIsMuted((prev) => !prev);\r\n        if (videoRef.current) {\r\n            videoRef.current.muted = !isMuted;\r\n        }\r\n    };\r\n\r\n    const isVideo = (url) => {\r\n        const videoExtensions = ['.mp4', '.webm', '.ogg'];\r\n        return videoExtensions.some((ext) => url.endsWith(ext));\r\n    };\r\n\r\n    useEffect(() => {\r\n        const videoElement = videoRef.current;\r\n        if (!videoElement) return;\r\n\r\n        const observer = new IntersectionObserver(\r\n            (entries) => {\r\n                entries.forEach((entry) => {\r\n                    if (entry.isIntersecting) {\r\n                        if (userWantsToPlay) {\r\n                            videoElement.play();\r\n                            setIsPlaying(true);\r\n                        }\r\n                    } else {\r\n                        videoElement.pause();\r\n                        setIsPlaying(false);\r\n                    }\r\n                });\r\n            },\r\n            { threshold: 0.5 } // хотя бы 50% видно\r\n        );\r\n\r\n        observer.observe(videoElement);\r\n\r\n        return () => {\r\n            observer.unobserve(videoElement);\r\n        };\r\n    }, [userWantsToPlay]);\r\n\r\n    return (\r\n        <div className={`${post.imgUrl && isVideo(post.imgUrl)} transition-all`}>\r\n            {post.imgUrl && isVideo(post.imgUrl) ? (\r\n                <div className=\"relative group\">\r\n                    <video\r\n                        ref={videoRef}\r\n                        width=\"100%\"\r\n                        height=\"100%\"\r\n                        maxheight=\"550px\"\r\n                        muted={isMuted}\r\n                        className=\"object-cover w-full\"\r\n                    >\r\n                        <source src={`${API_URL}/${post.imgUrl}`} type=\"video/mp4\" />\r\n                        Ваш браузер не поддерживает видео.\r\n                    </video>\r\n\r\n                    <div className=\"absolute inset-0 flex justify-center items-center bg-black bg-opacity-30 group-hover:flex hidden\">\r\n                        <button\r\n                            onClick={togglePlayPause}\r\n                            className=\"text-white opacity-50 hover:opacity-75 transition\"\r\n                        >\r\n                            {isPlaying ? (\r\n                                <FaPause className=\"max-md:w-8 max-md:h-8 w-20 h-20\" />\r\n                            ) : (\r\n                                <FaPlay className=\"max-md:w-8 max-md:h-8 w-20 h-20\" />\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={toggleMute}\r\n                        className=\"absolute bottom-4 right-4 p-2 bg-black bg-opacity-50 rounded-full text-white\"\r\n                    >\r\n                        {isMuted ? (\r\n                            <FaVolumeMute className=\"w-6 h-6\" />\r\n                        ) : (\r\n                            <FaVolumeUp className=\"w-6 h-6\" />\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            ) : (\r\n                <img\r\n                    src={`${API_URL}/${post.imgUrl}`}\r\n                    alt=\"Post content\"\r\n                    className=\"object-cover w-full h-full max-md:max-h-[250px] max-h-[500px]\"\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}