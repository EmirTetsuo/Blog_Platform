{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\neo\\\\Desktop\\\\veb\\\\23.02.23\\\\Blog\\\\frontend\\\\src\\\\features\\\\PostItemContent.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { FaVolumeUp, FaVolumeMute, FaPlay, FaPause, FaRedo } from 'react-icons/fa';\nimport { useSelector } from 'react-redux';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const PostItemContent = _ref => {\n  _s();\n\n  let {\n    post\n  } = _ref;\n  const user = useSelector(state => state.auth.user);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isMuted, setIsMuted] = useState(false);\n  const [userWantsToPlay, setUserWantsToPlay] = useState(false);\n  const API_URL = process.env.REACT_APP_API_URL;\n  const [isEnded, setIsEnded] = useState(false);\n  const videoRef = useRef(null);\n\n  const togglePlayPause = () => {\n    if (!userWantsToPlay) {\n      setUserWantsToPlay(true);\n    } else {\n      setUserWantsToPlay(false);\n      videoRef.current.pause();\n      setIsPlaying(false);\n    }\n  };\n\n  const handleReplay = () => {\n    if (videoRef.current) {\n      videoRef.current.currentTime = 0;\n      videoRef.current.play();\n      setIsPlaying(true);\n      setIsEnded(false);\n    }\n  };\n\n  const toggleMute = () => {\n    setIsMuted(prev => !prev);\n\n    if (videoRef.current) {\n      videoRef.current.muted = !isMuted;\n    }\n  };\n\n  const isVideo = url => {\n    const videoExtensions = ['.mp4', '.webm', '.ogg'];\n    return videoExtensions.some(ext => url.endsWith(ext));\n  };\n\n  useEffect(() => {\n    const videoElement = videoRef.current;\n    if (!videoElement) return;\n\n    const handleVisibilityChange = entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          if (userWantsToPlay) {\n            videoElement.play();\n            setIsPlaying(true);\n          }\n        } else {\n          videoElement.pause();\n          setIsPlaying(false);\n        }\n      });\n    };\n\n    const observer = new IntersectionObserver(handleVisibilityChange, {\n      threshold: 0.5\n    });\n    observer.observe(videoElement); // üü° –ü–†–û–í–ï–†–ö–ê: –≤–∏–¥–Ω–æ –ª–∏ —Å–µ–π—á–∞—Å (–≤ –ø–µ—Ä–≤—ã–π –º–æ–º–µ–Ω—Ç)\n\n    const rect = videoElement.getBoundingClientRect();\n    const isVisibleNow = rect.top >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight);\n\n    if (isVisibleNow && userWantsToPlay) {\n      videoElement.play();\n      setIsPlaying(true);\n    }\n\n    return () => {\n      observer.unobserve(videoElement);\n    };\n  }, [userWantsToPlay]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `${post.imgUrl && isVideo(post.imgUrl)} transition-all`,\n    children: post.imgUrl && isVideo(post.imgUrl) ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative group\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        width: \"100%\",\n        height: \"100%\",\n        muted: isMuted,\n        onEnded: () => {\n          setIsPlaying(false);\n          setIsEnded(true);\n        },\n        className: \"object-cover w-full h-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"source\", {\n          src: `${API_URL}/${post.imgUrl}`,\n          type: \"video/mp4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 25\n        }, this), \"\\u0412\\u0430\\u0448 \\u0431\\u0440\\u0430\\u0443\\u0437\\u0435\\u0440 \\u043D\\u0435 \\u043F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0438\\u0432\\u0430\\u0435\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 21\n      }, this), (isEnded || !isPlaying) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 flex justify-center items-center bg-black bg-opacity-50 group-hover:flex\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: isEnded ? handleReplay : togglePlayPause,\n          className: \"text-white opacity-70 hover:opacity-100 transition\",\n          children: isEnded ? /*#__PURE__*/_jsxDEV(FaRedo, {\n            className: \"max-md:w-8 max-md:h-8 w-20 h-20\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 37\n          }, this) : isPlaying ? /*#__PURE__*/_jsxDEV(FaPause, {\n            className: \"max-md:w-8 max-md:h-8 w-20 h-20\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 37\n          }, this) : /*#__PURE__*/_jsxDEV(FaPlay, {\n            className: \"max-md:w-8 max-md:h-8 w-20 h-20\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMute,\n        className: \"absolute bottom-4 right-4 p-2 bg-black bg-opacity-50 rounded-full text-white\",\n        children: isMuted ? /*#__PURE__*/_jsxDEV(FaVolumeMute, {\n          className: \"w-6 h-6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 29\n        }, this) : /*#__PURE__*/_jsxDEV(FaVolumeUp, {\n          className: \"w-6 h-6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 17\n    }, this) : /*#__PURE__*/_jsxDEV(\"img\", {\n      src: `${API_URL}/${post.imgUrl}`,\n      alt: \"Post content\",\n      className: \"object-cover w-full h-full\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 9\n  }, this);\n};\n\n_s(PostItemContent, \"+sq7zaZ9Djdnv6x0zE6Nj27csmU=\", false, function () {\n  return [useSelector];\n});\n\n_c = PostItemContent;\n\nvar _c;\n\n$RefreshReg$(_c, \"PostItemContent\");","map":{"version":3,"names":["React","useState","useRef","useEffect","FaVolumeUp","FaVolumeMute","FaPlay","FaPause","FaRedo","useSelector","PostItemContent","post","user","state","auth","isPlaying","setIsPlaying","isMuted","setIsMuted","userWantsToPlay","setUserWantsToPlay","API_URL","process","env","REACT_APP_API_URL","isEnded","setIsEnded","videoRef","togglePlayPause","current","pause","handleReplay","currentTime","play","toggleMute","prev","muted","isVideo","url","videoExtensions","some","ext","endsWith","videoElement","handleVisibilityChange","entries","forEach","entry","isIntersecting","observer","IntersectionObserver","threshold","observe","rect","getBoundingClientRect","isVisibleNow","top","bottom","window","innerHeight","document","documentElement","clientHeight","unobserve","imgUrl"],"sources":["C:/Users/neo/Desktop/veb/23.02.23/Blog/frontend/src/features/PostItemContent.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { FaVolumeUp, FaVolumeMute, FaPlay, FaPause, FaRedo } from 'react-icons/fa';\r\nimport { useSelector } from 'react-redux';\r\n\r\nexport const PostItemContent = ({ post }) => {\r\n    const user = useSelector((state) => state.auth.user);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const [userWantsToPlay, setUserWantsToPlay] = useState(false);\r\n    const API_URL = process.env.REACT_APP_API_URL;\r\n    const [isEnded, setIsEnded] = useState(false);\r\n\r\n    const videoRef = useRef(null);\r\n\r\n    const togglePlayPause = () => {\r\n        if (!userWantsToPlay) {\r\n            setUserWantsToPlay(true);\r\n        } else {\r\n            setUserWantsToPlay(false);\r\n            videoRef.current.pause();\r\n            setIsPlaying(false);\r\n        }\r\n    };\r\n\r\n    const handleReplay = () => {\r\n        if (videoRef.current) {\r\n            videoRef.current.currentTime = 0;\r\n            videoRef.current.play();\r\n            setIsPlaying(true);\r\n            setIsEnded(false);\r\n        }\r\n    };\r\n\r\n    const toggleMute = () => {\r\n        setIsMuted((prev) => !prev);\r\n        if (videoRef.current) {\r\n            videoRef.current.muted = !isMuted;\r\n        }\r\n    };\r\n\r\n    const isVideo = (url) => {\r\n        const videoExtensions = ['.mp4', '.webm', '.ogg'];\r\n        return videoExtensions.some((ext) => url.endsWith(ext));\r\n    };\r\n\r\n    useEffect(() => {\r\n        const videoElement = videoRef.current;\r\n        if (!videoElement) return;\r\n    \r\n        const handleVisibilityChange = (entries) => {\r\n            entries.forEach((entry) => {\r\n                if (entry.isIntersecting) {\r\n                    if (userWantsToPlay) {\r\n                        videoElement.play();\r\n                        setIsPlaying(true);\r\n                    }\r\n                } else {\r\n                    videoElement.pause();\r\n                    setIsPlaying(false);\r\n                }\r\n            });\r\n        };\r\n    \r\n        const observer = new IntersectionObserver(handleVisibilityChange, {\r\n            threshold: 0.5,\r\n        });\r\n    \r\n        observer.observe(videoElement);\r\n    \r\n        // üü° –ü–†–û–í–ï–†–ö–ê: –≤–∏–¥–Ω–æ –ª–∏ —Å–µ–π—á–∞—Å (–≤ –ø–µ—Ä–≤—ã–π –º–æ–º–µ–Ω—Ç)\r\n        const rect = videoElement.getBoundingClientRect();\r\n        const isVisibleNow =\r\n            rect.top >= 0 &&\r\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight);\r\n        \r\n        if (isVisibleNow && userWantsToPlay) {\r\n            videoElement.play();\r\n            setIsPlaying(true);\r\n        }\r\n    \r\n        return () => {\r\n            observer.unobserve(videoElement);\r\n        };\r\n    }, [userWantsToPlay]);\r\n    \r\n    return (\r\n        <div className={`${post.imgUrl && isVideo(post.imgUrl)} transition-all`}>\r\n            {post.imgUrl && isVideo(post.imgUrl) ? (\r\n                <div className=\"relative group\">\r\n                    <video\r\n                        ref={videoRef}\r\n                        width=\"100%\"\r\n                        height=\"100%\"\r\n                        muted={isMuted}\r\n                        onEnded={() => {\r\n                            setIsPlaying(false);\r\n                            setIsEnded(true);\r\n                        }}\r\n                        className=\"object-cover w-full h-full\"\r\n                    >\r\n                        <source src={`${API_URL}/${post.imgUrl}`} type=\"video/mp4\" />\r\n                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.\r\n                    </video>\r\n\r\n                    {(isEnded || !isPlaying) && (\r\n                        <div className=\"absolute inset-0 flex justify-center items-center bg-black bg-opacity-50 group-hover:flex\">\r\n                            <button\r\n                                onClick={isEnded ? handleReplay : togglePlayPause}\r\n                                className=\"text-white opacity-70 hover:opacity-100 transition\"\r\n                            >\r\n                                {isEnded ? (\r\n                                    <FaRedo className=\"max-md:w-8 max-md:h-8 w-20 h-20\" />\r\n                                ) : isPlaying ? (\r\n                                    <FaPause className=\"max-md:w-8 max-md:h-8 w-20 h-20\" />\r\n                                ) : (\r\n                                    <FaPlay className=\"max-md:w-8 max-md:h-8 w-20 h-20\" />\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n\r\n                    <button\r\n                        onClick={toggleMute}\r\n                        className=\"absolute bottom-4 right-4 p-2 bg-black bg-opacity-50 rounded-full text-white\"\r\n                    >\r\n                        {isMuted ? (\r\n                            <FaVolumeMute className=\"w-6 h-6\" />\r\n                        ) : (\r\n                            <FaVolumeUp className=\"w-6 h-6\" />\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            ) : (\r\n                <img\r\n                    src={`${API_URL}/${post.imgUrl}`}\r\n                    alt=\"Post content\"\r\n                    className=\"object-cover w-full h-full\"\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}